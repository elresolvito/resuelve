<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Resolvito - Tu Tienda en La Habana</title>
    <meta name="description" content="Tienda online en La Habana Vieja. Alimentos, ropa, manualidades y servicios. Env√≠o a domicilio.">
    
    <!-- OneSignal SDK -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'opensans': ['Open Sans', 'sans-serif'],
                    },
                    colors: {
                        'cuban-green': '#2E7D32',
                        'cuban-yellow': '#FFB300',
                        'cuban-blue': '#0277BD',
                        'cuban-cream': '#FFF8E1',
                        'cuban-dark': '#1B5E20',
                    }
                }
            }
        }
    </script>

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #FFF8E1;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        
        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .modal-enter {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .cart-slide {
            transition: transform 0.3s ease-in-out;
        }
        
        .cart-open {
            transform: translateY(0) !important;
        }
        
        .notification-toast {
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .pulse-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 50%, #0277BD 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .category-pill {
            scroll-snap-align: start;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .quantity-btn {
            min-width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .service-card {
            background: linear-gradient(145deg, #ffffff 0%, #f3f4f6 100%);
        }
        
        .price-tag {
            background: linear-gradient(135deg, #FFB300 0%, #FFA000 100%);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        }
        
        .floating-action {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .stock-badge {
            font-size: 0.65rem;
        }
    </style>
<base target="_blank">
</head>
<body class="bg-cuban-cream text-gray-800 pb-20">

    <!-- OneSignal Subscription Button -->
    <button id="notificationBtn" class="fixed top-20 right-4 z-40 bg-cuban-blue text-white p-3 rounded-full shadow-lg hidden hover:bg-blue-700 transition-colors floating-action">
        <i class="fas fa-bell"></i>
        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">1</span>
    </button>

    <!-- WhatsApp Float Button -->
    <a href="https://wa.me/5356382909" target="_blank" class="fixed bottom-20 right-4 z-40 btn-whatsapp text-white p-4 rounded-full shadow-lg hover:scale-110 transition-transform floating-action">
        <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- Cart Float Button -->
    <button onclick="toggleCart()" class="fixed bottom-4 right-4 z-40 bg-cuban-green text-white p-4 rounded-full shadow-lg hover:scale-110 transition-transform floating-action">
        <i class="fas fa-shopping-cart text-xl"></i>
        <span id="cartCount" class="absolute -top-1 -right-1 bg-cuban-yellow text-cuban-dark text-sm font-bold rounded-full w-6 h-6 flex items-center justify-center hidden">0</span>
    </button>

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <button onclick="toggleMenu()" class="p-2 hover:bg-gray-100 rounded-lg lg:hidden">
                    <i class="fas fa-bars text-2xl text-cuban-green"></i>
                </button>
                
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 bg-cuban-green rounded-full flex items-center justify-center text-white font-bold text-xl">
                        <i class="fas fa-store"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-cuban-green leading-tight">El Resolvito</h1>
                        <p class="text-xs text-gray-500">La Habana Vieja</p>
                    </div>
                </div>

                <div class="hidden lg:flex items-center gap-6">
                    <a href="#mercado" class="text-gray-700 hover:text-cuban-green font-medium">Mercado</a>
                    <a href="#servicios" class="text-gray-700 hover:text-cuban-green font-medium">Servicios</a>
                    <a href="#noticias" class="text-gray-700 hover:text-cuban-green font-medium">Ofertas</a>
                    <a href="https://instagram.com/elresolvito.habana" target="_blank" class="text-pink-600 hover:text-pink-700">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                </div>

                <button onclick="toggleCart()" class="p-2 hover:bg-gray-100 rounded-lg relative lg:hidden">
                    <i class="fas fa-shopping-cart text-2xl text-cuban-green"></i>
                    <span id="cartCountMobile" class="absolute top-0 right-0 bg-cuban-yellow text-cuban-dark text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                </button>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="border-t border-gray-100 px-4 py-2">
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="searchInput" placeholder="Buscar productos..." 
                    class="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:border-cuban-green focus:ring-2 focus:ring-cuban-green/20"
                    onkeyup="searchProducts()">
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="toggleMenu()">
        <div class="bg-white w-3/4 max-w-sm h-full p-6" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-cuban-green">Men√∫</h2>
                <button onclick="toggleMenu()" class="p-2">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <nav class="space-y-4">
                <a href="#mercado" onclick="toggleMenu()" class="block p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-shopping-basket mr-3 text-cuban-green"></i>Mercado
                </a>
                <a href="#servicios" onclick="toggleMenu()" class="block p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-tools mr-3 text-cuban-green"></i>Servicios
                </a>
                <a href="#noticias" onclick="toggleMenu()" class="block p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-newspaper mr-3 text-cuban-green"></i>Ofertas y Noticias
                </a>
                <a href="https://instagram.com/elresolvito.habana" target="_blank" class="block p-3 rounded-lg hover:bg-gray-100">
                    <i class="fab fa-instagram mr-3 text-pink-600"></i>Instagram
                </a>
                <a href="mailto:elresolvito@gmail.com" class="block p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-envelope mr-3 text-cuban-blue"></i>Contactar
                </a>
            </nav>
            
            <div class="mt-8 p-4 bg-cuban-cream rounded-lg">
                <p class="text-sm text-gray-600 mb-2"><i class="fab fa-whatsapp text-green-500 mr-2"></i>5356382909</p>
                <p class="text-sm text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>La Habana Vieja</p>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-gradient text-white py-12 px-4 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-10 left-10 w-32 h-32 bg-white rounded-full blur-3xl"></div>
            <div class="absolute bottom-10 right-10 w-48 h-48 bg-cuban-yellow rounded-full blur-3xl"></div>
        </div>
        
        <div class="container mx-auto max-w-4xl relative z-10 text-center">
            <span class="inline-block bg-cuban-yellow text-cuban-dark px-4 py-1 rounded-full text-sm font-bold mb-4 animate-pulse">
                üéâ Env√≠o solo $200 en La Habana Vieja
            </span>
            <h2 class="text-3xl md:text-5xl font-bold mb-4">Todo lo que necesitas, <br>al alcance de tu mano</h2>
            <p class="text-lg md:text-xl opacity-90 mb-6">Alimentos, higiene, bebidas y servicios en tu zona</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#mercado" class="bg-white text-cuban-green px-8 py-3 rounded-full font-bold hover:bg-gray-100 transition shadow-lg">
                    Ver Productos
                </a>
                <a href="https://wa.me/5356382909" target="_blank" class="bg-cuban-yellow text-cuban-dark px-8 py-3 rounded-full font-bold hover:bg-yellow-400 transition shadow-lg">
                    <i class="fab fa-whatsapp mr-2"></i>WhatsApp
                </a>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="py-6 bg-white shadow-sm sticky top-[120px] z-30">
        <div class="container mx-auto px-4">
            <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-2" id="categoryContainer">
                <button onclick="filterCategory('todos')" class="category-pill px-6 py-2 bg-cuban-green text-white rounded-full whitespace-nowrap font-medium hover:shadow-md transition active">
                    Todos
                </button>
                <button onclick="filterCategory('Alimentos y conservas')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Alimentos
                </button>
                <button onclick="filterCategory('Snacks y golosinas')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Snacks
                </button>
                <button onclick="filterCategory('Higiene personal')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Higiene
                </button>
                <button onclick="filterCategory('Bebidas alcoh√≥licas y malta')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Bebidas
                </button>
                <button onclick="filterCategory('Salsas')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Salsas
                </button>
                <button onclick="filterCategory('Perfumes y desodorantes')" class="category-pill px-6 py-2 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap font-medium hover:bg-gray-200 transition">
                    Perfumes
                </button>
            </div>
        </div>
    </section>

    <!-- News & Offers Section -->
    <section id="noticias" class="py-8 bg-gradient-to-r from-cuban-yellow/20 to-cuban-green/10">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl font-bold text-cuban-dark mb-6 flex items-center">
                <i class="fas fa-bullhorn mr-3 text-cuban-yellow"></i>Ofertas del Mes
            </h2>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-md border-l-4 border-cuban-green">
                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded font-bold">NUEVO</span>
                    <h3 class="font-bold text-lg mt-2">Compra por Mayor</h3>
                    <p class="text-gray-600 text-sm mt-1">Descuentos especiales para compras al por mayor. Consulta disponibilidad de caf√©, huevos y conservas.</p>
                    <button onclick="openNewsModal('mayor')" class="mt-3 text-cuban-green font-medium text-sm hover:underline">Ver m√°s ‚Üí</button>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-md border-l-4 border-cuban-blue">
                    <span class="bg-cuban-blue text-white text-xs px-2 py-1 rounded font-bold">PROMO</span>
                    <h3 class="font-bold text-lg mt-2">Env√≠o Gratis</h3>
                    <p class="text-gray-600 text-sm mt-1">En compras superiores a $5000 en La Habana Vieja. ¬°Aprovecha!</p>
                    <button onclick="openNewsModal('envio')" class="mt-3 text-cuban-blue font-medium text-sm hover:underline">Ver condiciones ‚Üí</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="mercado" class="py-8">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-cuban-dark">
                    <i class="fas fa-shopping-basket mr-3 text-cuban-green"></i>Cat√°logo
                </h2>
                <span id="productCount" class="text-gray-500 text-sm">Cargando...</span>
            </div>

            <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                <!-- Products injected here -->
            </div>
            
            <div id="noResults" class="hidden text-center py-12">
                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No se encontraron productos</p>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="servicios" class="py-8 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl font-bold text-cuban-dark mb-6 flex items-center">
                <i class="fas fa-tools mr-3 text-cuban-blue"></i>Servicios Disponibles
            </h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="service-card rounded-xl p-6 shadow-md hover:shadow-lg transition cursor-pointer" onclick="openServiceModal('barbero')">
                    <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center mb-4 text-2xl">üíà</div>
                    <h3 class="font-bold text-lg mb-2">Barbero</h3>
                    <p class="text-gray-600 text-sm">Cortes modernos, barba y tratamientos capilares a domicilio.</p>
                    <span class="inline-block mt-3 text-cuban-green text-sm font-medium">Ver disponibilidad ‚Üí</span>
                </div>
                
                <div class="service-card rounded-xl p-6 shadow-md hover:shadow-lg transition cursor-pointer" onclick="openServiceModal('tapiceria')">
                    <div class="w-14 h-14 bg-amber-100 rounded-full flex items-center justify-center mb-4 text-2xl">üõãÔ∏è</div>
                    <h3 class="font-bold text-lg mb-2">Tapicer√≠a</h3>
                    <p class="text-gray-600 text-sm">Reparaci√≥n y restauraci√≥n de muebles, sillas y sof√°s.</p>
                    <span class="inline-block mt-3 text-cuban-green text-sm font-medium">Solicitar presupuesto ‚Üí</span>
                </div>
                
                <div class="service-card rounded-xl p-6 shadow-md hover:shadow-lg transition cursor-pointer" onclick="openServiceModal('renta')">
                    <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mb-4 text-2xl">üè†</div>
                    <h3 class="font-bold text-lg mb-2">Casa de Renta</h3>
                    <p class="text-gray-600 text-sm">Alojamiento en La Habana Vieja. WiFi, aire acondicionado.</p>
                    <span class="inline-block mt-3 text-cuban-green text-sm font-medium">Ver fotos ‚Üí</span>
                </div>
                
                <div class="service-card rounded-xl p-6 shadow-md hover:shadow-lg transition cursor-pointer" onclick="openServiceModal('reparaciones')">
                    <div class="w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mb-4 text-2xl">üî®</div>
                    <h3 class="font-bold text-lg mb-2">Reparaciones</h3>
                    <p class="text-gray-600 text-sm">Electricidad, plomer√≠a, carpinter√≠a y m√°s servicios.</p>
                    <span class="inline-block mt-3 text-cuban-green text-sm font-medium">Contactar ‚Üí</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-cuban-dark text-white py-8 mt-8">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h3 class="font-bold text-xl mb-4">El Resolvito</h3>
                    <p class="text-gray-300 text-sm">Tu tienda de confianza en La Habana Vieja. Productos de calidad y servicios a tu alcance.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Contacto</h4>
                    <p class="text-gray-300 text-sm mb-2"><i class="fab fa-whatsapp mr-2"></i>5356382909</p>
                    <p class="text-gray-300 text-sm mb-2"><i class="fas fa-envelope mr-2"></i>elresolvito@gmail.com</p>
                    <p class="text-gray-300 text-sm"><i class="fas fa-map-marker-alt mr-2"></i>La Habana Vieja, Cuba</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">S√≠guenos</h4>
                    <div class="flex justify-center md:justify-start gap-4">
                        <a href="https://instagram.com/elresolvito.habana" target="_blank" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://whatsapp.com/channel/0029VbAdqJO2f3EL764Cro3G" target="_blank" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-white/20 mt-8 pt-4 text-center text-gray-400 text-sm">
                <p>&copy; 2024 El Resolvito. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" onclick="closeModal('productModal')">
        <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto modal-enter" onclick="event.stopPropagation()">
            <div class="relative">
                <img id="modalImage" src="" alt="" class="w-full h-64 object-cover rounded-t-2xl">
                <button onclick="closeModal('productModal')" class="absolute top-2 right-2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center hover:bg-black/70">
                    <i class="fas fa-times"></i>
                </button>
                <span id="modalStock" class="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full stock-badge">
                    Disponible
                </span>
            </div>
            <div class="p-6">
                <span id="modalCategory" class="text-cuban-green text-sm font-medium"></span>
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 mt-1 mb-2"></h3>
                <p id="modalDescription" class="text-gray-600 mb-4"></p>
                
                <div class="flex items-center justify-between mb-6">
                    <span id="modalPrice" class="text-3xl font-bold text-cuban-green"></span>
                    <div class="flex items-center gap-3 bg-gray-100 rounded-lg p-1">
                        <button onclick="adjustModalQuantity(-1)" class="quantity-btn bg-white rounded shadow text-gray-600 hover:bg-gray-50">-</button>
                        <span id="modalQuantity" class="font-bold w-8 text-center">1</span>
                        <button onclick="adjustModalQuantity(1)" class="quantity-btn bg-white rounded shadow text-gray-600 hover:bg-gray-50">+</button>
                    </div>
                </div>
                
                <button onclick="addToCartFromModal()" class="w-full bg-cuban-green text-white py-3 rounded-xl font-bold text-lg hover:bg-cuban-dark transition flex items-center justify-center gap-2">
                    <i class="fas fa-cart-plus"></i>
                    A√±adir al carrito
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartOverlay" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="toggleCart()"></div>
    <div id="cartSidebar" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-50 transform translate-y-full cart-slide max-h-[85vh] flex flex-col">
        <div class="p-4 border-b flex justify-between items-center bg-cuban-green text-white rounded-t-3xl">
            <h3 class="font-bold text-lg flex items-center">
                <i class="fas fa-shopping-cart mr-2"></i>
                Tu Carrito
            </h3>
            <button onclick="toggleCart()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="cartItems" class="flex-1 overflow-y-auto p-4 space-y-4">
            <!-- Cart items injected here -->
        </div>
        
        <div class="border-t p-4 bg-gray-50">
            <div class="space-y-2 mb-4">
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600">Subtotal:</span>
                    <span id="cartSubtotal" class="font-medium">$0</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600">Env√≠o (La Habana Vieja):</span>
                    <span id="cartShipping" class="font-medium text-cuban-green">$200</span>
                </div>
                <div class="border-t pt-2 flex justify-between text-lg font-bold">
                    <span>Total:</span>
                    <span id="cartTotal" class="text-cuban-green">$200</span>
                </div>
            </div>
            
            <button onclick="openCheckout()" class="w-full btn-whatsapp text-white py-3 rounded-xl font-bold text-lg hover:opacity-90 transition flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp"></i>
                Hacer pedido por WhatsApp
            </button>
            <p class="text-center text-xs text-gray-500 mt-2">Se abrir√° WhatsApp con tu pedido</p>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center p-4" onclick="closeModal('checkoutModal')">
        <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto modal-enter" onclick="event.stopPropagation()">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-4 flex items-center">
                    <i class="fab fa-whatsapp text-green-500 mr-2"></i>
                    Finalizar Pedido
                </h3>
                
                <form id="checkoutForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre completo *</label>
                        <input type="text" id="customerName" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono *</label>
                        <input type="tel" id="customerPhone" required placeholder="5xxxxxxx" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Direcci√≥n *</label>
                        <textarea id="customerAddress" required rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Referencias (opcional)</label>
                        <input type="text" id="customerReferences" placeholder="Color de puerta, entre calles..." class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">M√©todo de pago *</label>
                        <select id="paymentMethod" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent">
                            <option value="">Seleccionar...</option>
                            <option value="efectivo">Efectivo (CUP)</option>
                            <option value="transferencia">Transferencia</option>
                            <option value="mlc">MLC</option>
                        </select>
                    </div>
                    
                    <div id="cashAmountContainer" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">¬øCon cu√°nto pagas? (para calcular cambio)</label>
                        <input type="number" id="cashAmount" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cuban-green focus:border-transparent">
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold mb-2">Resumen:</h4>
                        <div id="checkoutSummary" class="text-sm space-y-1">
                            <!-- Summary injected here -->
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-cuban-green text-white py-3 rounded-xl font-bold hover:bg-cuban-dark transition">
                        Confirmar Pedido
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Service Modals -->
    <div id="serviceModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" onclick="closeModal('serviceModal')">
        <div class="bg-white rounded-2xl max-w-md w-full modal-enter" onclick="event.stopPropagation()">
            <div id="serviceContent" class="p-6">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- News Modal -->
    <div id="newsModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" onclick="closeModal('newsModal')">
        <div class="bg-white rounded-2xl max-w-md w-full modal-enter" onclick="event.stopPropagation()">
            <div class="p-6">
                <h3 id="newsTitle" class="text-xl font-bold mb-4"></h3>
                <div id="newsContent" class="text-gray-600 space-y-3"></div>
                <button onclick="closeModal('newsModal')" class="mt-6 w-full bg-cuban-green text-white py-2 rounded-lg font-medium">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="fixed top-24 right-4 bg-white rounded-lg shadow-xl p-4 z-50 hidden notification-toast max-w-xs border-l-4 border-cuban-green">
        <div class="flex items-start gap-3">
            <div class="text-cuban-green text-xl">
                <i class="fas fa-check-circle"></i>
            </div>
            <div>
                <h4 id="toastTitle" class="font-bold text-sm">Producto a√±adido</h4>
                <p id="toastMessage" class="text-xs text-gray-600 mt-1">Se ha a√±adido al carrito</p>
            </div>
            <button onclick="hideToast()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // ============================================
        // DATOS DE PRODUCTOS
        // ============================================
        const products = [
            {id:1, nombre:"At√∫n en lata", categoria:"Alimentos y conservas", precio:540, imagen:"https://i.postimg.cc/76xHK6zt/atun_precio_500.png", descripcion:"Lata est√°ndar 200g", stock:10},
            {id:2, nombre:"Pasta de tomate", categoria:"Alimentos y conservas", precio:350, imagen:"https://i.postimg.cc/gjjYPTNv/pasta_tomate_precio_350.png", descripcion:"Paquete", stock:10},
            {id:3, nombre:"Pimiento fresco", categoria:"Alimentos y conservas", precio:750, imagen:"https://i.postimg.cc/4yyJTSBj/pimiento_presio_750.png", descripcion:"Unidad", stock:10},
            {id:4, nombre:"Caf√© Dualis 250 g", categoria:"Alimentos y conservas", precio:1450, imagen:"https://i.postimg.cc/WbZBX2hN/cafe_dualis_250_g_precio_1450.png", descripcion:"Paquete 250 g", stock:10},
            {id:5, nombre:"Caf√© Dufiltro 250 g", categoria:"Alimentos y conservas", precio:1450, imagen:"https://i.postimg.cc/hG26fv31/cafe_Dufiltro_250_g_precio_1450.png", descripcion:"Paquete 250 g", stock:10},
            {id:6, nombre:"Caf√© Enepa", categoria:"Alimentos y conservas", precio:470, imagen:"https://i.postimg.cc/nhY6f04N/cafe_enepa_precio_450.png", descripcion:"Paquete", stock:10},
            {id:7, nombre:"Cart√≥n de huevo 30 u", categoria:"Alimentos y conservas", precio:3000, imagen:"https://i.postimg.cc/sDWkwVvv/carton_de_huevo_30_u_precio_3000.png", descripcion:"Cart√≥n", stock:10},
            {id:8, nombre:"Leche condensada", categoria:"Alimentos y conservas", precio:950, imagen:"https://i.postimg.cc/tT2XwjtT/leche_condensada.png", descripcion:"Lata 397 g", stock:10},
            {id:9, nombre:"Harina blanca 1 Kg", categoria:"Alimentos y conservas", precio:600, imagen:"https://i.postimg.cc/3xc2NHFB/harina_blanca1_kg.png", descripcion:"Paquete 1 Kg", stock:10},
            {id:10, nombre:"Chicoticos Pelly 90 g", categoria:"Snacks y golosinas", precio:400, imagen:"https://i.postimg.cc/1zv2fXjZ/chicoticos_pelly_90_g_precio_400.png", descripcion:"Paquete 90 g", stock:10},
            {id:11, nombre:"Papitas Campesinas", categoria:"Snacks y golosinas", precio:690, imagen:"https://i.postimg.cc/cLgrDtf9/papitas_campesinas_precio_690.png", descripcion:"Paquete", stock:10},
            {id:12, nombre:"Pelly Jam√≥n", categoria:"Snacks y golosinas", precio:580, imagen:"https://i.postimg.cc/pdQV7frX/pelly_jamon_precio_580.png", descripcion:"Paquete", stock:10},
            {id:13, nombre:"Mayonesa Mediana", categoria:"Salsas", precio:850, imagen:"https://i.postimg.cc/KzJZw2rR/mayonesa_precio_850.png", descripcion:"Frasco mediano", stock:10},
            {id:14, nombre:"Mayonesa Grande", categoria:"Salsas", precio:1100, imagen:"https://i.postimg.cc/Px2t9jzz/mayonesa_precio1100.png", descripcion:"Frasco grande", stock:10},
            {id:15, nombre:"Cuchilla de Afeitar", categoria:"Higiene personal", precio:100, imagen:"https://i.postimg.cc/8CdkdW7x/cuchilla_de_afeitar_precio_100.png", descripcion:"Unidad", stock:10},
            {id:16, nombre:"Jab√≥n Marwa", categoria:"Higiene personal", precio:150, imagen:"https://i.postimg.cc/3RK8tRpR/jabon_marwa_precio_150.png", descripcion:"Pastilla", stock:10},
            {id:17, nombre:"Papel Sanitario", categoria:"Higiene personal", precio:490, imagen:"https://i.postimg.cc/bwW289qD/papel_sanitario_precio_490i.png", descripcion:"Paquete", stock:10},
            {id:18, nombre:"Toallas Sanitarias", categoria:"Higiene personal", precio:450, imagen:"https://i.postimg.cc/KjjZyH0b/toallas_sanitarias_precio_450.png", descripcion:"Paquete", stock:10},
            {id:19, nombre:"Toallas H√∫medas", categoria:"Higiene personal", precio:690, imagen:"https://i.postimg.cc/W4ZSP3cw/toallas_humedas_precio_690.png", descripcion:"Paquete", stock:10},
            {id:20, nombre:"Jab√≥n de Lavar", categoria:"Aseo del hogar", precio:250, imagen:"https://i.postimg.cc/V6YfK6Mz/jabon_de_lavar_precio_250.png", descripcion:"Pastilla", stock:10},
            {id:21, nombre:"Perfume Candy", categoria:"Perfumes y desodorantes", precio:3100, imagen:"https://i.postimg.cc/vTgJRyhp/perfume_candy_precio_3100.png", descripcion:"Frasco 50 ml", stock:10},
            {id:22, nombre:"Perfume gen√©rico", categoria:"Perfumes y desodorantes", precio:3100, imagen:"https://i.postimg.cc/ZKrT0PPG/perfume_precio_3100.png", descripcion:"Frasco 50 ml", stock:10},
            {id:23, nombre:"Perfume Q", categoria:"Perfumes y desodorantes", precio:3100, imagen:"https://i.postimg.cc/CL03P3Dn/perfume_q_precio_3100.png", descripcion:"Frasco 50 ml", stock:10},
            {id:24, nombre:"Desodorante Obao", categoria:"Perfumes y desodorantes", precio:1100, imagen:"https://i.postimg.cc/PxtXSxD2/desodorante_obao_precio_1100.png", descripcion:"Spray/Roll-on", stock:10},
            {id:25, nombre:"Desodorante Rush Blanco", categoria:"Perfumes y desodorantes", precio:1000, imagen:"https://i.postimg.cc/FR9rTRS8/desodorante_rush_blanco_precio_1000.png", descripcion:"Roll-on", stock:10},
            {id:26, nombre:"Desodorante Rush", categoria:"Perfumes y desodorantes", precio:1000, imagen:"https://i.postimg.cc/sXVjTXSF/desodorante_rush_precio_1000.png", descripcion:"Spray", stock:10},
            {id:27, nombre:"Colonia Ni√±a", categoria:"Perfumes y desodorantes", precio:1100, imagen:"https://i.postimg.cc/G3v04rsM/colonia_nina.png", descripcion:"Botella 100 ml", stock:10},
            {id:28, nombre:"Macarrones", categoria:"Pastas y fideos", precio:300, imagen:"https://i.postimg.cc/Hsmz1H69/macarrones_precio_300.png", descripcion:"Paquete est√°ndar", stock:10},
            {id:29, nombre:"Sopas instant√°neas", categoria:"Pastas y fideos", precio:160, imagen:"https://i.postimg.cc/FzNTpQqK/sopas_instantaneas_precio_160.png", descripcion:"Paquete", stock:10},
            {id:30, nombre:"Licor de fresa", categoria:"Bebidas alcoh√≥licas y malta", precio:2500, imagen:"https://i.postimg.cc/59YT2x5p/licor_de_fresa_precio_2500.png", descripcion:"Botella", stock:10},
            {id:31, nombre:"Licor Cocobay", categoria:"Bebidas alcoh√≥licas y malta", precio:2500, imagen:"https://i.postimg.cc/7ZDW90Fz/locor_cocobay_precio_2500.png", descripcion:"Botella", stock:10},
            {id:32, nombre:"Whisky Spirit 200 ml", categoria:"Bebidas alcoh√≥licas y malta", precio:320, imagen:"https://i.postimg.cc/4N8W6q1t/tea_precio_320.png", descripcion:"Botella 200 ml", stock:10},
            {id:33, nombre:"Whisky 1L", categoria:"Bebidas alcoh√≥licas y malta", precio:1350, imagen:"https://i.postimg.cc/cLyrb4T0/whisky_1L_precio_1350.png", descripcion:"Botella 1 L", stock:10},
            {id:34, nombre:"Whisky Sir Albin", categoria:"Bebidas alcoh√≥licas y malta", precio:550, imagen:"https://i.postimg.cc/y84kbYnC/whisky_sir_albin_precio_550.png", descripcion:"Botella peque√±a", stock:10},
            {id:35, nombre:"Vino Pluvium", categoria:"Bebidas alcoh√≥licas y malta", precio:1200, imagen:"https://i.postimg.cc/XNLLWmmx/vino_pluvium_precio_1200.png", descripcion:"Botella", stock:10},
            {id:36, nombre:"Bater√≠as Triple A", categoria:"Electr√≥nicos y accesorios", precio:300, imagen:"https://i.postimg.cc/DZ2vxZsT/Gemini_Generated_Image_824rio824rio824r.png", descripcion:"Pack de 4 unidades", stock:10}
        ];

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let cart = [];
        let currentModalProduct = null;
        let modalQuantity = 1;
        let currentCategory = 'todos';
        let isOneSignalInitialized = false;
        let userSubscriptionId = null;

        // Rangos de env√≠o
        const SHIPPING_RANGES = [
            { max: 2000, fee: 400, discount: "0%" },
            { max: 5000, fee: 300, discount: "25%" },
            { max: Infinity, fee: 200, discount: "50%" }
        ];

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            initializeOneSignal();
            setupEventListeners();
            updateCartUI();
            
            // Verificar carrito guardado
            const savedCart = localStorage.getItem('elResolvitoCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartUI();
            }
        });

        // ============================================
        // ONESIGNAL INTEGRACI√ìN
        // ============================================
        function initializeOneSignal() {
            if (typeof OneSignal === 'undefined') {
                console.log('OneSignal no disponible');
                return;
            }

            const oneSignalAppId = "1c761702-8750-4994-97eb-06e700a50236";
            
            window.OneSignal = window.OneSignal || [];
            
            OneSignal.push(function() {
                OneSignal.init({
                    appId: oneSignalAppId,
                    notifyButton: { enable: false },
                    allowLocalhostAsSecureOrigin: true,
                    autoRegister: false,
                    autoResubscribe: true,
                    persistNotification: false,
                    welcomeNotification: {
                        title: "¬°Bienvenido a El Resolvito!",
                        message: "Recibir√°s notificaciones de ofertas y nuevos productos.",
                    }
                });

                OneSignal.getUserId(function(userId) {
                    if (userId) {
                        userSubscriptionId = userId;
                        hideNotificationButton();
                    } else {
                        showNotificationButton();
                    }
                });

                OneSignal.on('subscriptionChange', function(isSubscribed) {
                    if (isSubscribed) {
                        OneSignal.getUserId(function(userId) {
                            userSubscriptionId = userId;
                            hideNotificationButton();
                            showToast('¬°Notificaciones activadas!', 'Ahora recibir√°s nuestras mejores ofertas');
                        });
                    } else {
                        userSubscriptionId = null;
                        showNotificationButton();
                    }
                });

                isOneSignalInitialized = true;
            });
        }

        function showNotificationButton() {
            const btn = document.getElementById('notificationBtn');
            if (btn) btn.classList.remove('hidden');
        }

        function hideNotificationButton() {
            const btn = document.getElementById('notificationBtn');
            if (btn) btn.classList.add('hidden');
        }

        document.getElementById('notificationBtn')?.addEventListener('click', function() {
            if (!isOneSignalInitialized) return;
            OneSignal.showNativePrompt();
        });

        // ============================================
        // RENDERIZADO DE PRODUCTOS
        // ============================================
        function renderProducts(filter = 'todos', searchTerm = '') {
            const grid = document.getElementById('productsGrid');
            const noResults = document.getElementById('noResults');
            const countLabel = document.getElementById('productCount');
            
            let filtered = products;
            
            if (filter !== 'todos') {
                filtered = filtered.filter(p => p.categoria === filter);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(p => 
                    p.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.descripcion.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            countLabel.textContent = `${filtered.length} productos`;
            
            if (filtered.length === 0) {
                grid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            grid.innerHTML = filtered.map(product => `
                <div class="product-card bg-white rounded-xl shadow-md overflow-hidden cursor-pointer" onclick="openProductModal(${product.id})">
                    <div class="relative h-40 overflow-hidden bg-gray-100">
                        <img src="${product.imagen}" alt="${product.nombre}" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
                        ${product.stock < 5 ? '<span class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">¬°√öltimos!</span>' : ''}
                    </div>
                    <div class="p-3">
                        <p class="text-xs text-cuban-green font-medium mb-1">${product.categoria}</p>
                        <h3 class="font-bold text-gray-800 text-sm mb-1 line-clamp-2 h-10">${product.nombre}</h3>
                        <p class="text-xs text-gray-500 mb-2">${product.descripcion}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-cuban-green">$${product.precio}</span>
                            <button onclick="event.stopPropagation(); quickAddToCart(${product.id})" class="w-8 h-8 bg-cuban-green text-white rounded-full flex items-center justify-center hover:bg-cuban-dark transition">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // FILTRADO Y B√öSQUEDA
        // ============================================
        function filterCategory(category) {
            currentCategory = category;
            
            // Actualizar UI de botones
            document.querySelectorAll('.category-pill').forEach(btn => {
                if (btn.textContent.trim() === getCategoryLabel(category)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-cuban-green', 'text-white');
                } else {
                    btn.classList.remove('bg-cuban-green', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            });
            
            const searchTerm = document.getElementById('searchInput').value;
            renderProducts(category, searchTerm);
        }

        function getCategoryLabel(cat) {
            const labels = {
                'todos': 'Todos',
                'Alimentos y conservas': 'Alimentos',
                'Snacks y golosinas': 'Snacks',
                'Higiene personal': 'Higiene',
                'Bebidas alcoh√≥licas y malta': 'Bebidas',
                'Salsas': 'Salsas',
                'Perfumes y desodorantes': 'Perfumes'
            };
            return labels[cat] || cat;
        }

        function searchProducts() {
            const term = document.getElementById('searchInput').value;
            renderProducts(currentCategory, term);
        }

        // ============================================
        // MODALES DE PRODUCTO
        // ============================================
        function openProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentModalProduct = product;
            modalQuantity = 1;
            
            document.getElementById('modalImage').src = product.imagen;
            document.getElementById('modalTitle').textContent = product.nombre;
            document.getElementById('modalDescription').textContent = product.descripcion;
            document.getElementById('modalPrice').textContent = `$${product.precio}`;
            document.getElementById('modalCategory').textContent = product.categoria;
            document.getElementById('modalQuantity').textContent = modalQuantity;
            document.getElementById('modalStock').textContent = product.stock > 0 ? 'Disponible' : 'Agotado';
            document.getElementById('modalStock').className = product.stock > 0 ? 
                'absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full stock-badge' :
                'absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full stock-badge';
            
            document.getElementById('productModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function adjustModalQuantity(delta) {
            const newQty = modalQuantity + delta;
            if (newQty >= 1 && newQty <= (currentModalProduct?.stock || 10)) {
                modalQuantity = newQty;
                document.getElementById('modalQuantity').textContent = modalQuantity;
            }
        }

        function addToCartFromModal() {
            if (!currentModalProduct) return;
            addToCart(currentModalProduct.id, modalQuantity);
            closeModal('productModal');
        }

        function quickAddToCart(productId) {
            addToCart(productId, 1);
        }

        // ============================================
        // CARRITO DE COMPRAS
        // ============================================
        function addToCart(productId, quantity) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: product.id,
                    name: product.nombre,
                    price: product.precio,
                    image: product.imagen,
                    quantity: quantity
                });
            }
            
            saveCart();
            updateCartUI();
            showToast('Producto a√±adido', `${product.nombre} x${quantity} a√±adido al carrito`);
            
            // Animar bot√≥n del carrito
            const cartBtn = document.querySelector('.fa-shopping-cart').parentElement;
            cartBtn.classList.add('scale-125');
            setTimeout(() => cartBtn.classList.remove('scale-125'), 200);
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateCartUI();
        }

        function updateCartItemQuantity(productId, delta) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                    updateCartUI();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('elResolvitoCart', JSON.stringify(cart));
        }

        function calculateShipping(subtotal) {
            for (const range of SHIPPING_RANGES) {
                if (subtotal <= range.max) {
                    return { fee: range.fee, text: range.max === Infinity ? 'M√°s de $5,000' : `Hasta $${range.max}` };
                }
            }
            return { fee: 200, text: 'M√°s de $5,000' };
        }

        function updateCartUI() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Actualizar contadores
            const countElements = [document.getElementById('cartCount'), document.getElementById('cartCountMobile')];
            countElements.forEach(el => {
                if (el) {
                    el.textContent = count;
                    el.classList.toggle('hidden', count === 0);
                }
            });
            
            // Renderizar items
            const cartItems = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-shopping-cart text-4xl mb-3 opacity-30"></i>
                        <p>Tu carrito est√° vac√≠o</p>
                        <button onclick="toggleCart()" class="mt-4 text-cuban-green font-medium">Ver productos</button>
                    </div>
                `;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="flex gap-3 bg-gray-50 p-3 rounded-lg">
                        <img src="${item.image}" class="w-16 h-16 object-cover rounded-lg">
                        <div class="flex-1">
                            <h4 class="font-medium text-sm line-clamp-1">${item.name}</h4>
                            <p class="text-cuban-green font-bold">$${item.price}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <button onclick="updateCartItemQuantity(${item.id}, -1)" class="w-6 h-6 bg-white rounded shadow text-xs">-</button>
                                <span class="text-sm font-medium w-6 text-center">${item.quantity}</span>
                                <button onclick="updateCartItemQuantity(${item.id}, 1)" class="w-6 h-6 bg-white rounded shadow text-xs">+</button>
                                <button onclick="removeFromCart(${item.id})" class="ml-auto text-red-500 text-xs">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Calcular totales
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = calculateShipping(subtotal);
            const total = subtotal + shipping.fee;
            
            document.getElementById('cartSubtotal').textContent = `$${subtotal}`;
            document.getElementById('cartShipping').textContent = `$${shipping.fee} (${shipping.text})`;
            document.getElementById('cartTotal').textContent = `$${total}`;
        }

        function toggleCart() {
            const sidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('cartOverlay');
            
            if (sidebar.classList.contains('cart-open')) {
                sidebar.classList.remove('cart-open');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            } else {
                sidebar.classList.add('cart-open');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        // ============================================
        // CHECKOUT Y WHATSAPP
        // ============================================
        function openCheckout() {
            if (cart.length === 0) {
                showToast('Carrito vac√≠o', 'A√±ade productos antes de continuar');
                return;
            }
            
            toggleCart();
            
            // Generar resumen
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = calculateShipping(subtotal);
            
            document.getElementById('checkoutSummary').innerHTML = `
                ${cart.map(item => `
                    <div class="flex justify-between">
                        <span>${item.name} x${item.quantity}</span>
                        <span>$${item.price * item.quantity}</span>
                    </div>
                `).join('')}
                <div class="border-t pt-1 mt-1 flex justify-between font-bold">
                    <span>Total + Env√≠o ($${shipping.fee}):</span>
                    <span>$${subtotal + shipping.fee}</span>
                </div>
            `;
            
            document.getElementById('checkoutModal').classList.remove('hidden');
        }

        document.getElementById('checkoutForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            sendOrder();
        });

        document.getElementById('paymentMethod')?.addEventListener('change', function(e) {
            const cashContainer = document.getElementById('cashAmountContainer');
            if (e.target.value === 'efectivo') {
                cashContainer.classList.remove('hidden');
            } else {
                cashContainer.classList.add('hidden');
            }
        });

        function sendOrder() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const address = document.getElementById('customerAddress').value;
            const references = document.getElementById('customerReferences').value;
            const payment = document.getElementById('paymentMethod').value;
            const cashAmount = document.getElementById('cashAmount').value;
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = calculateShipping(subtotal);
            const total = subtotal + shipping.fee;
            
            // Construir mensaje de WhatsApp
            let message = `*¬°Nuevo Pedido El Resolvito!*\n\n`;
            message += `*Cliente:* ${name}\n`;
            message += `*Tel√©fono:* ${phone}\n`;
            message += `*Direcci√≥n:* ${address}\n`;
            if (references) message += `*Referencias:* ${references}\n`;
            message += `*Pago:* ${payment.toUpperCase()}\n`;
            if (payment === 'efectivo' && cashAmount) {
                message += `*Paga con:* $${cashAmount} (cambio: $${cashAmount - total})\n`;
            }
            message += `\n*Productos:*\n`;
            
            cart.forEach(item => {
                message += `‚Ä¢ ${item.name} x${item.quantity} = $${item.price * item.quantity}\n`;
            });
            
            message += `\n*Subtotal:* $${subtotal}`;
            message += `\n*Env√≠o:* $${shipping.fee} (${shipping.text})`;
            message += `\n*TOTAL:* $${total}`;
            message += `\n\n¬°Gracias por tu compra!`;
            
            // Enviar a Google Sheets
            sendToGoogleSheets({
                nombre: name,
                telefono: phone,
                direccion: address,
                referencias: references,
                pago: payment,
                productos: cart.map(i => `${i.name}x${i.quantity}`).join(', '),
                total: total,
                fecha: new Date().toLocaleString()
            });
            
            // Abrir WhatsApp
            window.open(`https://wa.me/5356382909?text=${encodeURIComponent(message)}`, '_blank');
            
            // Limpiar carrito
            cart = [];
            saveCart();
            updateCartUI();
            closeModal('checkoutModal');
            
            showToast('¬°Pedido enviado!', 'Te redirigimos a WhatsApp');
        }

        function sendToGoogleSheets(data) {
            const scriptUrl = 'https://script.google.com/macros/s/AKfycby9Sk3Fz2_WqRQsEXrezpwqKbpYhqW_-ialMJcYKPdvZkrBfNReWWFfQ-VnXTrkJY8W/exec';
            
            fetch(scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(err => console.log('Error Sheets:', err));
        }

        // ============================================
        // SERVICIOS
        // ============================================
        function openServiceModal(type) {
            const modal = document.getElementById('serviceModal');
            const content = document.getElementById('serviceContent');
            
            const services = {
                barbero: {
                    icon: 'üíà',
                    title: 'Servicio de Barbero',
                    desc: 'Cortes modernos, barba, tratamientos capilares y m√°s.',
                    details: 'Disponible: Lunes a S√°bado 9am - 7pm\nPrecios desde $300 CUP\nDomicilio: +$100'
                },
                tapiceria: {
                    icon: 'üõãÔ∏è',
                    title: 'Tapicer√≠a y Muebles',
                    desc: 'Restauraci√≥n de sillas, sof√°s, cambio de tela y reparaci√≥n de estructuras.',
                    details: 'Presupuesto sin compromiso\nTrabajo garantizado\nMateriales de calidad'
                },
                renta: {
                    icon: 'üè†',
                    title: 'Casa de Renta',
                    desc: 'Alojamiento independiente en La Habana Vieja.',
                    details: 'WiFi incluido\nAire acondicionado\nCocina equipada\nPrecio: $25/noche'
                },
                reparaciones: {
                    icon: 'üî®',
                    title: 'Reparaciones Generales',
                    desc: 'Electricidad, plomer√≠a, carpinter√≠a, pintura.',
                    details: 'Urgencias 24h\nPresupuesto gratis\nExperiencia garantizada'
                }
            };
            
            const s = services[type];
            content.innerHTML = `
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2">${s.icon}</div>
                    <h3 class="text-2xl font-bold">${s.title}</h3>
                </div>
                <p class="text-gray-600 mb-4">${s.desc}</p>
                <div class="bg-gray-50 p-4 rounded-lg mb-4 whitespace-pre-line text-sm">${s.details}</div>
                <a href="https://wa.me/5356382909?text=Hola, estoy interesado en el servicio de ${s.title}" target="_blank" class="block w-full btn-whatsapp text-white text-center py-3 rounded-xl font-bold">
                    <i class="fab fa-whatsapp mr-2"></i>Solicitar por WhatsApp
                </a>
            `;
            
            modal.classList.remove('hidden');
        }

        // ============================================
        // NOTICIAS/OFERTAS
        // ============================================
        function openNewsModal(type) {
            const modal = document.getElementById('newsModal');
            const title = document.getElementById('newsTitle');
            const content = document.getElementById('newsContent');
            
            if (type === 'mayor') {
                title.textContent = 'Compra por Mayor';
                content.innerHTML = `
                    <p>¬øTienes un negocio o quieres revender? Tenemos precios especiales:</p>
                    <ul class="list-disc pl-5 space-y-1 mt-2">
                        <li>Caf√© (5+ unidades): 10% descuento</li>
                        <li>Huevos (3+ cartones): $2800/cart√≥n</li>
                        <li>Conservas (10+ unidades): 15% descuento</li>
                    </ul>
                    <p class="mt-3 font-medium">Contacta por WhatsApp para m√°s detalles.</p>
                `;
            } else {
                title.textContent = 'Env√≠o Gratis';
                content.innerHTML = `
                    <p>Condiciones de env√≠o:</p>
                    <ul class="list-disc pl-5 space-y-1 mt-2">
                        <li>Compras >$5000: Env√≠o GRATIS</li>
                        <li>Compras $2001-$5000: Env√≠o $300</li>
                        <li>Compras <$2000: Env√≠o $400</li>
                    </ul>
                    <p class="mt-3 text-sm text-gray-500">Solo v√°lido para La Habana Vieja.</p>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        // ============================================
        // UTILIDADES
        // ============================================
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.body.style.overflow = '';
        }

        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        function showToast(title, message) {
            const toast = document.getElementById('notificationToast');
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            
            toast.classList.remove('hidden');
            setTimeout(hideToast, 3000);
        }

        function hideToast() {
            document.getElementById('notificationToast').classList.add('hidden');
        }

        function setupEventListeners() {
            // Cerrar modales con ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    ['productModal', 'checkoutModal', 'serviceModal', 'newsModal'].forEach(id => {
                        document.getElementById(id)?.classList.add('hidden');
                    });
                    document.body.style.overflow = '';
                }
            });
        }
    </script>
</body>
</html>
